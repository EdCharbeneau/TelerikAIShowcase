@page "/assistant"
@using System.Reflection
@using System.ComponentModel.DataAnnotations
@using Telerik.Blazor.Components

<TelerikNotification @ref="notification" 
    HorizontalPosition="@NotificationHorizontalPosition.Center"
    VerticalPosition="@NotificationVerticalPosition.Top" 
     />

<TelerikDockManager Height="calc(100vh - 160px)">
    <DockManagerPanes>
        <DockManagerSplitPane>
            <Panes>
                <DockManagerContentPane Id="members" Maximizable="false" HeaderText="Assistant" Size="30%">
                    <Content>
                        <TelerikChat Data="uiChatHistory" 
                            TextField="@nameof(UIChatMessage.Content)" 
                            OnSendMessage="@(async (args) => await HandlePromptRequest(args))">
                    </TelerikChat>
                    </Content>
                </DockManagerContentPane>
                <DockManagerSplitPane Id="details" Orientation="@DockManagerPaneOrientation.Vertical">
                    <Panes>
                        <DockManagerContentPane Id="bio" Maximizable="false" HeaderText="RMA Process">
                            <Content>
                                <TelerikForm 
                                    Columns="2"
                                    EditContext="editContext" 
                                    OnValidSubmit="HumanSubmit">
                                    <FormItems>
                                        <FormAutoGeneratedItems />
                                        <DataAnnotationsValidator />
                                    </FormItems>
                                </TelerikForm>
                            </Content>
                        </DockManagerContentPane>
                    </Panes>
                </DockManagerSplitPane>
                <DockManagerContentPane Id="debug" Maximizable="false" HeaderText="Debug" Size="30%">
                    <Content>
                        @foreach (var message in messages)
                        {
                            <ChatMessageContent Message="message">
                                <AssistantTextContentTemplate>
                                    <div class="k-m-5 k-d-flex k-flex-col k-border k-border-solid k-border-border k-bg-surface-alt k-overflow-x-auto k-rounded-lg">
                                        <div class="k-p-5 k-bg-tertiary-subtle">
                                            <p>@context</p>
                                        </div>
                                    </div>
                                </AssistantTextContentTemplate>
                                <FunctionCallTemplate Context="func">
                                    @{

                                        var (content, result) = func;
                                        <div class="k-m-5 k-d-flex k-flex-col k-border k-border-solid k-border-border k-bg-surface-alt k-overflow-x-auto k-rounded-lg">
                                            <div class="k-p-5 k-bg-tertiary">
                                            <p>@content.Name</p>
                                    
                                            @if (content.Arguments is { Count: > 0 } args)
                                            {
                                                <p>Arguments:</p>
                                                foreach (var item in args)
                                                {
                                                    <p style="overflow-wrap: break-word">@item.Value</p>
                                                }
                                            }
                                            </div>
                                        </div>
                                    }
                                </FunctionCallTemplate>
                            </ChatMessageContent>
                        }
                    </Content>
                </DockManagerContentPane>
            </Panes>
        </DockManagerSplitPane>
    </DockManagerPanes>
</TelerikDockManager>